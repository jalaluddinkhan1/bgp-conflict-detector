# ExaBGP Configuration for BGP Session Simulation
# Simulates 80K BGP peers for load testing

# Process configuration
process {
    receive {
        # Receive BGP updates
        neighbor-changes;
        neighbor-updates;
    }
    send {
        # Send BGP updates
        rate-limit;
    }
}

# Template for generating BGP peers
template peer-template {
    local-address 10.0.0.1;
    local-as 65000;
    peer-as 65001;
    hold-time 180;
    keepalive 60;
    family {
        ipv4 unicast;
        ipv6 unicast;
    }
}

# Generate 80K BGP peers
# Note: ExaBGP may need to be run with multiple instances
# to handle 80K peers efficiently. This is a template configuration.

# Example: Generate 1000 peers per instance
# Run 80 instances to get 80K peers total

# Peer group 1: 10.0.0.0/16 network
group peers-group-1 {
    # Generate peers from 10.0.1.1 to 10.0.255.254
    # This gives us ~65K IPs, but we'll use a subset
    
    # Example peers (scale this pattern)
    neighbor 10.0.1.1 {
        inherit peer-template;
        peer-as 65001;
        router-id 10.0.1.1;
    }
    
    neighbor 10.0.1.2 {
        inherit peer-template;
        peer-as 65002;
        router-id 10.0.1.2;
    }
    
    # Add more neighbors as needed
    # For 80K peers, use a script to generate this configuration
}

# API for dynamic peer management
api {
    processes {
        [ 'exabgp-cli' ];
    }
    neighbor-changes;
}

# Logging
log {
    destination /var/log/exabgp/exabgp.log;
    level INFO;
}

# Performance tuning for large scale
# Uncomment and adjust based on your system
# neighbor-changes {
#     receive {
#         parsing true;
#         update false;
#     }
# }

